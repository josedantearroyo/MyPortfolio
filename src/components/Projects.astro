---
import { Icon } from "astro-icon/components"

const TAGS = {
    NEXT:{
        name:"Next.js",
        class: "bg-black text-white",
        icon: "tabler:brand-nextjs",
    },
    TAILWIND:{
        name:"Tailwind CSS",
        class: "bg-teal-500 text-white",
        icon: "tabler:brand-tailwind",
    },
    REACT:{
        name:"React",
        class: "bg-blue-500 text-white",
        icon: "tabler:brand-react",
    },
    JAVASCRIPT:{
        name:"JavaScript",
        class: "bg-yellow-500 text-black",
        icon: "tabler:brand-javascript",
    },
    NODEJS:{
        name:"Node.js",
        class: "bg-green-600 text-white",
        icon: "tabler:brand-nodejs",
    },
    ASTRO:{
        name:"Astro",
        class: "bg-purple-600 text-white",
        icon: "tabler:rocket",
    },
    MYSQL:{
        name:"MySQL",
        class: "bg-blue-700 text-white",
        icon: "tabler:brand-mysql",
    },
    LARAVEL:{
        name:"Laravel",
        class: "bg-red-600 text-white",
        icon: "tabler:brand-laravel",
    },
    // Nuevos logos usando Simple Icons
    SPRINGBOOT:{
        name:"Spring Boot",
        class: "bg-green-500 text-white",
        icon: "simple-icons:springboot",
    },
    JAVA:{
        name:"Java",
        class: "bg-orange-600 text-white",
        icon: "simple-icons:oracle",
    },
    MONGODB:{
        name:"MongoDB",
        class: "bg-green-700 text-white",
        icon: "simple-icons:mongodb",
    },
    POSTGRESQL:{
        name:"PostgreSQL",
        class: "bg-blue-800 text-white",
        icon: "simple-icons:postgresql",
    },
    DOCKER:{
        name:"Docker",
        class: "bg-blue-600 text-white",
        icon: "simple-icons:docker",
    },
    PYTHON:{
        name:"Python",
        class: "bg-yellow-400 text-black",
        icon: "simple-icons:python",
    },
    DJANGO:{
        name:"Django",
        class: "bg-green-800 text-white",
        icon: "simple-icons:django",
    },
    VUE:{
        name:"Vue.js",
        class: "bg-green-500 text-white",
        icon: "simple-icons:vuedotjs",
    },
    ANGULAR:{
        name:"Angular",
        class: "bg-red-700 text-white",
        icon: "simple-icons:angular",
    },
    TYPESCRIPT:{
        name:"TypeScript",
        class: "bg-blue-600 text-white",
        icon: "simple-icons:typescript",
    },
}

const PROJECTS = [
    {
        title: "Kimsa Inventory",
        description: "Software de inventario y facturación para pequeñas y medianas empresas. Sistema completo con gestión de productos, clientes, proveedores y reportes.",
        link: "#en-desarrollo",
        github: null,
        isPrivate: false,
        isLocalOnly: true,
        isInDevelopment: true,
        tags: [TAGS.NEXT, TAGS.TAILWIND, TAGS.REACT],
        image: "/images/desarrollo.jpg",
    },
    {
        title: "API REST Spring Boot",
        description: "API REST robusta desarrollada con Spring Boot y Java para gestión de usuarios, autenticación JWT y operaciones CRUD con base de datos PostgreSQL.",
        link: "#en-desarrollo",
        github: null,
        isPrivate: false,
        isLocalOnly: true,
        isInDevelopment: true,
        tags: [TAGS.SPRINGBOOT, TAGS.JAVA, TAGS.POSTGRESQL],
        image: "/images/desarrollo.jpg",
    },
    {
        title: "E-Learning EduPro cursos online",
        description: "Plataforma de educación en línea con cursos interactivos, gestión de usuarios y panel de administración, desarrollada con Astro, tailwind CSS y JavaScript.",
        link: "https://wonderful-sopapillas-17aa80.netlify.app/",
        github: "https://github.com/username/ecommerce",
        tags: [TAGS.ASTRO, TAGS.TAILWIND, TAGS.JAVASCRIPT,TAGS.REACT],
        image: "/images/edupro.png",
    },
    {
        title: "Tienda para mascotas PetFriendSolution",
        description: "Landing page para productos de mascotas, con diseño atractivo y funcionalidad de carrito de compras simulada.",
        link: "https://sensational-crepe-e261e1.netlify.app/",
        github: "https://github.com/username/sistema-gestion",
        tags: [TAGS.ASTRO, TAGS.TYPESCRIPT, TAGS.TAILWIND, TAGS.JAVASCRIPT],
        image: "/images/petfriend.png",
    },
    {
        title: "Portafolio Web",
        description: "Portafolio personal desarrollado con Astro, TypeScript, con modo oscuro, animaciones y diseño responsive optimizado para rendimiento.",
        link: "",
        github: "https://github.com/josedantearroyo/MyPortfolio",
        tags: [TAGS.ASTRO, TAGS.TAILWIND, TAGS.TYPESCRIPT],
        image: "/images/portafolio.png",
    },
    {
        title: "App Web Gestión de Boletas",
        description: "Sistema web para digitalización y gestión de boletas de la UGEL ANDAHUAYLAS con búsqueda avanzada y reportes.",
        link: "#local-deployment",
        github: null,
        isPrivate: false,
        isLocalOnly: true,
        tags: [TAGS.SPRINGBOOT, TAGS.MYSQL, TAGS.REACT, TAGS.JAVASCRIPT],
        image: "/images/sistemaugel.png",
    },
]
---

<div class="w-full mt-0">
    <!-- Título de la sección -->
    <div class="text-center mb-12">
        <h3 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-4">
            Proyectos Destacados
        </h3>
        <p class="text-lg text-gray-600 dark:text-gray-400">
            Mis proyectos desarrollados con tecnologías modernas.
        </p>
    </div>

    <!-- Grid responsive de proyectos -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-2 sm:px-0">
        {
            PROJECTS.map(({image, title, description, tags, link, github, isPrivate, isLocalOnly, isInDevelopment}, index) => (
                <article class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 group mx-2 sm:mx-0 flex flex-col h-full">
                    <!-- Imagen del proyecto -->
                    <div class="relative h-48 bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-700 dark:to-gray-600 overflow-hidden flex-shrink-0">
                        {image ? (
                            <img 
                                src={image} 
                                alt={title}
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                            />
                        ) : (
                            <div class="absolute inset-0 flex items-center justify-center">
                                <Icon name="tabler:photo" class="w-12 h-12 text-gray-400 dark:text-gray-500" />
                            </div>
                        )}
                        
                        <!-- Overlay para desktop (solo hover) -->
                        <div class="hidden md:flex absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 items-center justify-center gap-3">
                            {link && !isLocalOnly && !isInDevelopment && (
                                <a 
                                    href={link} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="bg-white/20 backdrop-blur-sm border border-white/30 text-white px-3 py-2 rounded-lg hover:bg-white/30 transition-all duration-200 flex items-center gap-2 text-sm"
                                >
                                    <Icon name="tabler:external-link" class="w-4 h-4" />
                                    Demo
                                </a>
                            )}
                            {(isLocalOnly || isInDevelopment) && (
                                <button 
                                    class="bg-orange-500/60 backdrop-blur-sm border border-orange-400/50 text-orange-100 px-3 py-2 rounded-lg cursor-not-allowed flex items-center gap-2 text-sm"
                                    disabled
                                    title={isInDevelopment ? "Proyecto en desarrollo" : "Demo no disponible públicamente"}
                                >
                                    <Icon name={isInDevelopment ? "tabler:tools" : "tabler:lock"} class="w-4 h-4" />
                                    {isInDevelopment ? "En Desarrollo" : "Demo"}
                                </button>
                            )}
                            {github && !isInDevelopment && (
                                <a 
                                    href={github} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="bg-white/20 backdrop-blur-sm border border-white/30 text-white px-3 py-2 rounded-lg hover:bg-white/30 transition-all duration-200 flex items-center gap-2 text-sm"
                                >
                                    <Icon name="tabler:brand-github" class="w-4 h-4" />
                                    Código
                                </a>
                            )}
                            {isInDevelopment && (
                                <button 
                                    class="bg-orange-500/60 backdrop-blur-sm border border-orange-400/50 text-orange-100 px-3 py-2 rounded-lg cursor-not-allowed flex items-center gap-2 text-sm"
                                    disabled
                                    title="Código no disponible - proyecto en desarrollo"
                                >
                                    <Icon name="tabler:code-off" class="w-4 h-4" />
                                    Código
                                </button>
                            )}
                        </div>

                        <!-- Botones para móvil (siempre visibles) -->
                        <div class="md:hidden absolute top-3 right-3 flex gap-2">
                            {link && !isLocalOnly && !isInDevelopment && (
                                <a 
                                    href={link} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="bg-black/70 backdrop-blur-sm text-white p-2 rounded-full hover:bg-black/80 transition-all duration-200"
                                    title="Ver Demo"
                                >
                                    <Icon name="tabler:external-link" class="w-4 h-4" />
                                </a>
                            )}
                            {(isLocalOnly || isInDevelopment) && (
                                <button 
                                    class="bg-orange-600/70 backdrop-blur-sm text-orange-100 p-2 rounded-full cursor-not-allowed"
                                    disabled
                                    title={isInDevelopment ? "Proyecto en desarrollo" : "Demo no disponible públicamente"}
                                >
                                    <Icon name={isInDevelopment ? "tabler:tools" : "tabler:lock"} class="w-4 h-4" />
                                </button>
                            )}
                            {github && !isInDevelopment && (
                                <a 
                                    href={github} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="bg-black/70 backdrop-blur-sm text-white p-2 rounded-full hover:bg-black/80 transition-all duration-200"
                                    title="Ver Código"
                                >
                                    <Icon name="tabler:brand-github" class="w-4 h-4" />
                                </a>
                            )}
                            {isInDevelopment && (
                                <button 
                                    class="bg-orange-600/70 backdrop-blur-sm text-orange-100 p-2 rounded-full cursor-not-allowed"
                                    disabled
                                    title="Código no disponible - proyecto en desarrollo"
                                >
                                    <Icon name="tabler:code-off" class="w-4 h-4" />
                                </button>
                            )}
                        </div>
                    </div>

                    <!-- Contenido de la tarjeta -->
                    <div class="p-5 flex flex-col flex-grow">
                        <!-- Título -->
                        <h4 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200">
                            {title}
                        </h4>
                        
                        <!-- Contenedor de descripción con altura fija -->
                        <div class="flex-grow mb-4">
                            <div class={`description-container relative overflow-hidden project-${index}`}>
                                <!-- Descripción completa en móvil, con "Ver más" en desktop -->
                                <div class="md:hidden">
                                    <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed mb-3">
                                        {description}
                                    </p>
                                </div>
                                
                                <!-- Descripción con "Ver más" solo en desktop -->
                                <div class="hidden md:block">
                                    <div class="description-wrapper transition-all duration-300 ease-in-out mb-3">
                                        <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed description-text" data-full-text={description} data-short-text={description.length > 150 ? description.substring(0, 150) + "..." : description}>
                                            {description.length > 150 ? description.substring(0, 150) + "..." : description}
                                        </p>
                                    </div>
                                    {description.length > 150 && (
                                        <button 
                                            class="read-more-btn text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-xs font-medium mb-3 transition-all duration-200 bg-transparent border-none hover:shadow-lg hover:shadow-blue-500/20 dark:hover:shadow-blue-400/20 px-2 py-1 rounded-md"
                                            data-index={index}
                                        >
                                            <span class="button-text">Ver más</span>
                                            <Icon name="tabler:chevron-down" class="w-3 h-3 ml-1 transition-transform duration-200 chevron-icon" />
                                        </button>
                                    )}
                                </div>
                            </div>

                            <!-- Tags (visible en todas las pantallas) -->
                            <div class="flex flex-wrap gap-1.5">
                                {tags.map((tag) => (
                                    <span class={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${tag.class} transition-all duration-200 hover:scale-105`}>
                                        <Icon name={tag.icon} class="w-3 h-3" />
                                        {tag.name}
                                    </span>
                                ))}
                            </div>
                        </div>

                        <!-- Enlaces -->
                        <div class="flex gap-3 mt-auto">
                            {link && !isLocalOnly && !isInDevelopment && (
                                <a 
                                    href={link} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-center py-2.5 px-4 rounded-lg transition-all duration-200 text-sm font-medium hover:shadow-lg"
                                >
                                    Ver Proyecto
                                </a>
                            )}
                            {isLocalOnly && !isInDevelopment && (
                                <button 
                                    class="flex-1 bg-gray-500 text-white text-center py-2.5 px-4 rounded-lg text-sm font-medium cursor-not-allowed flex items-center justify-center gap-2"
                                    title="Proyecto desplegado únicamente en servidor local"
                                    disabled
                                >
                                    <Icon name="tabler:server" class="w-4 h-4" />
                                    Servidor Local
                                </button>
                            )}
                            {isInDevelopment && (
                                <button 
                                    class="flex-1 bg-orange-500 text-white text-center py-2.5 px-4 rounded-lg text-sm font-medium cursor-not-allowed flex items-center justify-center gap-2"
                                    title="Proyecto en desarrollo - próximamente disponible"
                                    disabled
                                >
                                    <Icon name="tabler:tools" class="w-4 h-4" />
                                    En Desarrollo
                                </button>
                            )}
                            {github && !isInDevelopment && (
                                <a 
                                    href={github} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class={`${(link && !isLocalOnly) || isLocalOnly ? 'bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 p-2.5' : 'flex-1 bg-gray-800 hover:bg-gray-900 dark:bg-gray-600 dark:hover:bg-gray-500 text-white text-center py-2.5 px-4 flex items-center justify-center gap-2'} rounded-lg transition-all duration-200 hover:shadow-md text-sm font-medium`}
                                    title="Ver código en GitHub"
                                >
                                    <Icon name="tabler:brand-github" class={`${(link && !isLocalOnly) || isLocalOnly ? 'w-5 h-5' : 'w-4 h-4'}`} />
                                    {!((link && !isLocalOnly) || isLocalOnly) && 'Ver Código'}
                                </a>
                            )}
                        </div>
                    </div>
                </article>
            ))
        }
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Funcionalidad optimizada de "Ver más"
        document.querySelectorAll('.read-more-btn').forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault();
                const target = event.currentTarget as HTMLButtonElement;
                
                const container = target.closest('.description-container') as HTMLElement;
                if (!container) return;
                
                const wrapper = container.querySelector('.description-wrapper') as HTMLElement;
                const text = container.querySelector('.description-text') as HTMLElement;
                const buttonText = target.querySelector('.button-text') as HTMLElement;
                const chevron = target.querySelector('.chevron-icon') as HTMLElement;
                
                if (!wrapper || !text || !buttonText || !chevron) return;
                
                const fullText = text.getAttribute('data-full-text');
                const shortText = text.getAttribute('data-short-text');
                
                if (!fullText || !shortText) return;
                
                const isExpanded = buttonText.textContent === 'Ver menos';
                
                if (!isExpanded) {
                    // Expandir
                    text.textContent = fullText;
                    buttonText.textContent = 'Ver menos';
                    chevron.style.transform = 'rotate(180deg)';
                    wrapper.style.maxHeight = 'none';
                } else {
                    // Contraer
                    text.textContent = shortText;
                    buttonText.textContent = 'Ver más';
                    chevron.style.transform = 'rotate(0deg)';
                    wrapper.style.maxHeight = '5rem'; // Aproximadamente 3-4 líneas
                }
            });
        });

        // Establecer altura inicial para textos largos (solo en desktop)
        document.querySelectorAll('.description-wrapper').forEach((wrapper, index) => {
            const text = wrapper.querySelector('.description-text') as HTMLElement;
            if (!text) return;
            
            const fullText = text.getAttribute('data-full-text');
            if (fullText && fullText.length > 150) {
                (wrapper as HTMLElement).style.maxHeight = '5rem';
            }
        });
    });
</script>

<style>
    /* Estilos para la consistencia de las tarjetas */
    article {
        min-height: 450px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    article:hover {
        transform: translateY(-2px);
    }

    /* Contenedor de descripción optimizado */
    .description-container {
        position: relative;
        flex-grow: 1;
    }

    .description-wrapper {
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        line-height: 1.5;
    }

    /* Botón de leer más con resplandor */
    .read-more-btn {
        display: inline-flex;
        align-items: center;
        position: relative;
        z-index: 10;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: transparent;
    }

    .read-more-btn:hover {
        transform: translateY(-1px);
        text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        filter: drop-shadow(0 0 6px rgba(59, 130, 246, 0.3));
    }

    .dark .read-more-btn:hover {
        text-shadow: 0 0 8px rgba(96, 165, 250, 0.5);
        filter: drop-shadow(0 0 6px rgba(96, 165, 250, 0.3));
    }

    .chevron-icon {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Asegurar que todos los elementos del contenido tengan la misma estructura */
    .p-5 {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        min-height: 0; /* Permite que flex funcione correctamente */
    }

    /* Responsividad mejorada */
    @media (max-width: 768px) {
        .grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
            padding: 0 0.5rem;
        }
        
        article {
            margin: 0 0.25rem;
            min-height: auto;
        }


    }

    @media (min-width: 769px) and (max-width: 1024px) {
        .grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        article {
            min-height: 440px;
        }
    }

    @media (min-width: 1025px) {
        .grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    /* Mejores sombras y efectos */
    article {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    article:hover {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* Evitar que las tarjetas se deformen */
    .flex-grow {
        min-height: 0;
    }

    /* Asegurar que los tags no interfieran con el diseño */
    .flex.flex-wrap.gap-1\.5.mb-4 {
        flex-shrink: 0;
    }

    /* Asegurar que los botones estén en la parte inferior */
    .flex.gap-3.mt-auto {
        flex-shrink: 0;
        margin-top: auto;
    }
</style>